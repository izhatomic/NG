---
# tasks file for roles/bastion
- name: install packages
  apt:
    pkg:
    - git
    - ansible
    - python3
    update_cache: yes
  become: true

- name: Copy ssh private key to root
  shell:
    cmd: "sudo cp /home/{{ ssh_ansible_user }}/.ssh/id_rsa /root/.ssh/"

- name: Copy ssh public key to root
  shell:
    cmd: "sudo cp /home/{{ ssh_ansible_user }}/.ssh/id_rsa.pub /root/.ssh/" 

- name: get repo
  git:
    repo: "{{ repo }}/{{ user}}/{{ proj }}.git"
    dest: "~/{{ proj }}/"

- name: deploy servers
  shell:
    cmd: ansible-playbook bastion-playbook.yml
    chdir: "~/{{ proj }}/Ansible"
